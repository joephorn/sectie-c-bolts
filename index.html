<!doctype html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Sectie-C Bolts</title>
    <style>
      :root{ --bar-h: 64px; }
      html,body{margin:0;height:100%;background:#fff;}
      body{display:flex;flex-direction:column;height:100vh;}
      #shortcuts{height:var(--bar-h);box-sizing:border-box;padding:10px 14px;display:flex;gap:16px;align-items:center;border-bottom:1px solid #e6e6e6;font:14px/1.4 system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;}
      #shortcuts .kbd{font-family: ui-monospace, SFMono-Regular, Menlo, monospace; background:#f3f3f3; border:1px solid #ddd; border-bottom-color:#ccc; padding:2px 6px; border-radius:6px; box-shadow:inset 0 -1px 0 rgba(0,0,0,.06);} 
      #shortcuts .item{display:flex;align-items:center;gap:8px;white-space:nowrap;}
      #c{flex:1 1 auto; width:100%; height:calc(100vh - var(--bar-h)); display:block;}
    </style>
    <script src="https://unpkg.com/gsap@3.12.5/dist/gsap.min.js"></script>
    <script type="text/javascript" src="https://unpkg.com/acorn"></script>
    <script type="text/javascript" src="https://unpkg.com/paper"></script>
</head>
<body>
    <div id="shortcuts" role="navigation" aria-label="Shortcuts">
        <div class="item"><span class="kbd" data-key="1">1</span> Line (scroll)</div>
        <div class="item"><span class="kbd" data-key="2">2</span> Line offset</div>
        <div class="item"><span class="kbd" data-key="3">3</span> Arc down</div>
        <div class="item"><span class="kbd" data-key="4">4</span> Arc up</div>
        <div class="item"><span class="kbd" data-key="5">5</span> Circle (scroll)</div>
        <div class="item"><span class="kbd" data-key="6">6</span> > (scroll)</div>
        <div class="item"><span class="kbd" data-key="7">7</span> +</div>
        <div class="item"><span class="kbd" data-key="8">8</span> x</div>

        <div class="item" style="margin-left:auto">
            Jitter
            <input id="jitter" type="range" min="0" max="100" value="0" step="1">
            <span id="jitterVal" class="kbd">0%</span>
        </div>
    </div>
    <canvas id="c"></canvas>

    <!-- Plaats dit boven of onder je <canvas id="c"> in index.html -->
        <div id="recorder-ui" style="position:fixed; left:900px; top:12px; z-index:9999; display:flex; gap:8px; font-family:system-ui;">
        <button id="rec-start">Start recording</button>
        <button id="rec-stop" disabled>Stop & download</button>
        <span id="rec-status" style="margin-left:6px; opacity:.75;"></span>
        </div>

        <script>
        (function(){
        const canvas = document.getElementById('c');
        if (!canvas) { console.warn('Canvas #c niet gevonden'); return; }

        // UI
        const btnStart = document.getElementById('rec-start');
        const btnStop  = document.getElementById('rec-stop');
        const statusEl = document.getElementById('rec-status');

        // Settings
        const FPS = 60; // kies 30 of 60; neemt de framerate over van captureStream
        const PREFERRED_TYPES = [
            'video/webm;codecs=vp9',
            'video/webm;codecs=vp8',
            'video/webm'
        ];

        let mediaRecorder = null;
        let chunks = [];
        let stream = null;

        function pickMimeType() {
            for (const t of PREFERRED_TYPES) {
            if (MediaRecorder.isTypeSupported && MediaRecorder.isTypeSupported(t)) return t;
            }
            return ''; // laat browser kiezen
        }

        function filename() {
            const d = new Date();
            const pad = n => String(n).padStart(2,'0');
            return `recording_${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}_${pad(d.getHours())}-${pad(d.getMinutes())}-${pad(d.getSeconds())}.webm`;
        }

        btnStart.addEventListener('click', () => {
            try {
            // stream exact op canvas-resolutie (afhankelijk van jouw canvas.width/height)
            stream = canvas.captureStream(FPS);
            const type = pickMimeType();
            mediaRecorder = new MediaRecorder(stream, type ? { mimeType: type } : {});
            chunks = [];

            mediaRecorder.ondataavailable = (e) => {
                if (e.data && e.data.size > 0) chunks.push(e.data);
            };

            mediaRecorder.onstart = () => {
                btnStart.disabled = true;
                btnStop.disabled = false;
                statusEl.textContent = 'Recordingâ€¦';
            };

            mediaRecorder.onstop = () => {
                btnStart.disabled = false;
                btnStop.disabled = true;
                statusEl.textContent = '';
                // bouw blob en download
                const blob = new Blob(chunks, { type: mediaRecorder.mimeType || 'video/webm' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = filename();
                document.body.appendChild(a);
                a.click();
                setTimeout(() => {
                URL.revokeObjectURL(url);
                a.remove();
                }, 1000);
                // cleanup
                stream.getTracks().forEach(t => t.stop());
                stream = null;
                mediaRecorder = null;
                chunks = [];
            };

            mediaRecorder.start(); // je kunt ook een timeslice ms meegeven, bv. mediaRecorder.start(250)
            } catch (err) {
            console.error('Recorder start error:', err);
            statusEl.textContent = 'Recording niet ondersteund in deze browser.';
            }
        });

        btnStop.addEventListener('click', () => {
            if (mediaRecorder && mediaRecorder.state === 'recording') {
            mediaRecorder.stop();
            }
        });

        // handige safety: stop automatisch bij navigatie
        window.addEventListener('beforeunload', () => {
            try { if (mediaRecorder && mediaRecorder.state === 'recording') mediaRecorder.stop(); } catch(_){}
            try { if (stream) stream.getTracks().forEach(t => t.stop()); } catch(_){}
        });
        })();
        </script>
    <script src="./script.js"></script>
</body>
</html>